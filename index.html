<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Voucher System – User</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
  
  <style>
    :root{--accent:#2f80ed;--ok:#10b981;--warn:#f59e0b;--bg:#0b0d12;--card:#121722;--text:#e6edf5;--muted:#9aa7b2;}
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.4 system-ui,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
    header{padding:18px 16px;border-bottom:1px solid #1f2937;display:flex;gap:12px;align-items:center;justify-content:space-between}
    a{color:#a5d8ff}
    h1{font-size:18px;margin:0}
    .container{max-width:900px;margin:24px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid #232b3a;border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    label{display:block;margin:6px 0 6px;color:var(--muted)}
    input[type=file],input[type=text],input[type=email],input[type=password],button{background:#0f131b;border:1px solid #263043;color:#e6edf5;padding:10px;border-radius:10px}
    button{cursor:pointer}
    button.primary{background:var(--accent);border-color:transparent;color:white}
    button.ghost{background:transparent}
    .log{background:#0f131b;border:1px dashed #2a3446;border-radius:10px;padding:10px;white-space:pre-wrap;max-height:220px;overflow:auto}
    .codes{font-family:ui-monospace,Menlo,Consolas,monospace}
    .hidden{display:none}
    .badge{padding:.15rem .46rem;border-radius:999px;font-size:12px;border:1px solid #334155;color:#cbd5e1}
    .success{color:#d1fae5;border-color:#065f46;background:#064e3b52}
    .warn{color:#ffe5b4;border-color:#b45309;background:#713f1266}
    .sliderWrap{padding:14px;background:#0f131b;border:1px solid #263043;border-radius:14px}
    .sliderWrap input[type=range]{width:100%}
    .big{font-size:28px;letter-spacing:1px}
    .center{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px}
    .loading{gap:8px;align-items:center}
    .loading:before{content:"";width:14px;height:14px;border:2px solid #cbd5e1;border-top-color:transparent;border-radius:50%;display:inline-block;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    /* --- AUTH GATING --- */
    .auth .auth-only { display: none !important; }
    .unauth .authed-only { display: none !important; }
    /* optional: cegah FOUC saat load */
    .authed-only { visibility: hidden; }
    .auth .authed-only { visibility: visible; }

  
    .inputWrap{display:flex;align-items:center;gap:8px;flex-wrap:nowrap}
    .domainTag{display:inline-flex;align-items:center;border:1px solid #263043;background:#0f131b;color:#9aa7b2;border-radius:10px;padding:10px 12px;white-space:nowrap}
    @media (max-width:520px){ .inputWrap{flex-wrap:wrap} }
  </style>

</head>
<body class="unauth">
  <header>
    <h1>Voucher User — Generate & Slide</h1>
  </header>
  <div class="container">
    <div class="card auth-only" id="userAuthBox" style="margin-bottom:12px;background:#0f131b">
      <h3 style="margin:0 0 8px">Login / Daftar (Email OTP)</h3>
        <div class="row">
          <div class="inputWrap">
            <input id="otpLocal" type="text" placeholder="username saja (mis. tester)" />
            <span class="domainTag">@dataon.com</span>
          </div>
          <button id="btnSendOtp" class="primary">Kirim Link OTP</button>
          <button id="btnLogout" class="ghost authed-only">Logout</button>
          <span id="otpStatus" class="badge hidden"></span>
        </div>
      <small class="badge">Cek email lalu klik link untuk kembali ke halaman ini.</small>
    </div>

    <div class="card center authed-only">
      <button id="btnGenerate" class="primary" style="min-width:220px">Generate Voucher</button>
      <div id="genLoading" class="loading hidden">Sedang generate kode…</div>

      <span id="genStatus" class="badge hidden"></span>

      <div id="claimWrap" class="hidden" style="width:100%">
        <p class="badge warn">Geser slider sampai penuh untuk <strong>menampilkan</strong> dan <strong>menggunakan</strong> voucher.</p>
        <div class="sliderWrap">
          <input id="revealSlider" type="range" value="0" min="0" max="100" />
          <div class="row" style="justify-content:space-between;color:#9aa7b2">
            <span>Geser ▶</span>
            <span>100%</span>
          </div>
        </div>
        <div id="voucherShow" class="card hidden center" style="margin-top:12px;background:#0f131b">
          <div class="badge success">Voucher Anda</div>
          <div id="voucherCode" class="big codes">•••••-•••••</div>
          <button id="btnCopy" class="ghost">Copy</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="./js/app.js"></script>
  <script type="module" src="./js/user.js"></script>
</body>
</html>