<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://unpkg.com https://cdn.skypack.dev https://cdn.jsdelivr.net 'unsafe-inline' 'unsafe-eval' blob:; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data:; connect-src 'self' https://*.supabase.co https://cdn.jsdelivr.net; worker-src 'self' blob: https://cdn.jsdelivr.net; frame-ancestors 'none'; base-uri 'self'; form-action 'self'; object-src 'none'">
  <meta http-equiv="Referrer-Policy" content="no-referrer">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <title>Voucher System – User</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
  <link rel="stylesheet" href="./css/styles.css">
  
  
  

</head>
<body class="unauth">
  <header>
    <h1>Voucher User — Generate & Slide</h1>
    <div class="row" style="gap:8px;align-items:center">
      <button id="btnTheme" class="ghost">Light Mode</button>
      <span id="whoUser" class="badge user authed-only"></span>
      <button id="btnLogout" class="ghost authed-only">Logout</button>
    </div>
  </header>
  <div class="container">
    <div class="card auth-only" id="userAuthBox" style="margin-bottom:12px;background:#0f131b">
      <h3 style="margin:0 0 8px">Login / Daftar (Email OTP)</h3>
        <div class="row">
          <div class="inputWrap">
            <input id="otpLocal" type="text" placeholder="username saja (mis. tester)" />
            <span class="domainTag">@dataon.com</span>
          </div>
          <button id="btnSendOtp" class="primary">Kirim Link OTP</button>
          <span id="otpStatus" class="badge hidden"></span>
        </div>
      <small class="badge">Cek email lalu klik link untuk kembali ke halaman ini.</small>
    </div>

    <div class="card center authed-only">
      <button id="btnGenerate" class="primary" style="min-width:220px">Generate Voucher</button>
      <div id="genLoading" class="loading hidden">Sedang generate kode…</div>

      <span id="genStatus" class="badge hidden"></span>

      <div id="claimWrap" class="hidden" style="width:100%">
        <p class="badge warn">Geser slider sampai penuh untuk <strong>menampilkan</strong> dan <strong>menggunakan</strong> voucher.</p>
        <div id="sliderWrap" class="sliderWrap">
          <div id="sliderBubble" class="bubble">0%</div>
          <input id="revealSlider" type="range" value="0" min="0" max="100" />
          <div class="row" style="justify-content:space-between;color:#9aa7b2">
            <span>Geser ▶</span>
            <span>100%</span>
          </div>
        </div>
        <div id="voucherShow" class="card hidden center" style="margin-top:12px;background:#0f131b">
          <div class="badge success">Voucher Anda</div>
          <div id="voucherCode" class="big codes">•••••-•••••</div>
          <button id="btnCopy" class="ghost">Copy</button>
        </div>
      </div>
      <div class="card authed-only" style="width:100%;background:#0f131b;margin-top:12px">
        <h3 style="margin:0 0 8px">Voucher Saya</h3>
        <div class="row" style="justify-content:space-between">
          <span class="badge">Riwayat klaim</span>
          <span id="remainClaims" class="badge"></span>
        </div>
        <div id="myVouchers" class="log codes" style="margin-top:8px;max-height:260px"></div>
      </div>
    </div>
  </div>

  <script type="module" src="./js/app.js"></script>
  <script type="module" src="./js/user.js"></script>
</body>
</html>
